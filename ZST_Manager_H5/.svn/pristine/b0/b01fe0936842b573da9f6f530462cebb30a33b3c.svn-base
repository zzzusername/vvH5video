<template>
  <div class="wrapper">
    <Header logoName="掌上通管理平台" :isForgetpas='false'></Header>
    <div class="main">
        <div class="Pasontent">
            <div class="pason-cont">
                <div class="hd">
                    <ul class="for-tab">
                        <li>验证身份</li>
                        <span class="line"></span>
                        <li>重置密码</li>
                         <span class="line"></span>
                        <li>重置成功</li>
                    </ul>
                </div>
                <div class="bd">
                    <div class="authenticate">
                        <p>您正在使用'短信验证'进行校验，请填写您要找回密码的账号</p>
                        <div class="item">
                             <el-input placeholder="请输入手机号" v-model="parameter.phone"></el-input>
                        </div>
                        <div class="item">
                            <el-input placeholder="验证码" v-model="parameter.code"></el-input>
                            <img :src='parameter.src' alt="" class="imgCode" @click="switchVerificationcode">
                        </div>
                        <div class="item">
                            <el-input placeholder="请输入短信验证码"></el-input>
                            <span class="btnSpan" @click="getVerificationphoneCode">获取验证码</span>
                        </div>
                        <el-button>下一步</el-button>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
  </div>
</template>

<script>
import $ from "jquery";
import axios from "axios";
import Header from "./Header";

/* api */
// PostlLogincode 获取 图形验证码
// sendSmsverificationCodeforResetpassword 获取短信验证码
// resetPassword 重置密码
import {PostlLogincode, sendSmsverificationCodeforResetpassword,resetPassword} from '@/components/interface/common.js'

export default {
  data: function() {
    return {
        isShow : true,
        // 图片验证码
        imgCode : '',
        parameter: {
                phone: "",
                code: "",
                // 图片地址
                src : '',
                // 验证提交信息
                cipher: "",
            }
    };
  },
  components: {
    Header,
  },
  destroyed: function() {
    console.log("页面关闭了");
  },
  methods : {
      // 获取图形 验证码
    getInitimgCode(){
        // PostlLogincode
        let objData = {
            height: 40,
            length: 4,
            width: 95
        }
        PostlLogincode(objData).then(res => {
          if (res.status === 200 && res.data.result == "ok") {
            console.log(res);
            this.parameter.src = "data:image/jpeg;base64," + res.data.data.image;
            this.parameter.cipher = res.data.data.cipher;
          }
        });
        
    },
    // 切换 验证码
    switchVerificationcode(){
        this.getInitimgCode();
    },
    //获取手机验证码
    getVerificationphoneCode(){
        // 获取手机验证码  验证输入 图形 验证码是否正确
        let objData = {
            "phonenum": this.parameter.phone,
        }
        sendSmsverificationCodeforResetpassword(objData).then(res => {
            if (res.status === 200 && res.data.result == "ok") {
                console.log(res);
            }else{
                // 错误提示信息 账号不存在
                this.$message.error(res.data.error_description);
            }
        });

    },
  },
  mounted() {
    var hei = document.documentElement.clientHeight;
    // 初始化高度
    $(".wrapper").css("height", hei);
    $('.Pasontent').css('height', hei - $(".head").height() - 60)
    // 动态计算
    $(window).resize(function() {
      var appH = $("#app").height();
      $(".wrapper").height(appH);
      $('.Pasontent').css('height', appH - $(".head").height() - 60)
    });
    // 获取图形 验证码
    this.getInitimgCode()
  }
};
</script>
<style scoped>
/* tab  */
.for-tab{
    overflow: hidden;
}
.for-tab li{
    float: left;
}
.for-tab .line{
    position: relative;
    top: 7px;
    float: left;
    width: 100px;
    height: 5px;
    line-height: 50px;
    background: red;
}
.imgCode{
    width: 135px;
    height: 40px;
}
.Pasontent{
    margin: 30px;
    background: #354166;
}
.pason-cont{
    width: 700px;
    margin: 0 auto;
}
.btnSpan{
    cursor: pointer;
}
</style>


