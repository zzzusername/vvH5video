<template>
	<div id="userlog" class="mRight">
		<div class="userlogList">
			<div class="zForm">
				<span class="paddingLeft">开始日期： </span>
                <div class="timeBox">
					<el-date-picker v-model="startTime" type="date" format="yyyy-MM-dd" value-format="timestamp" placeholder="开始日期"></el-date-picker>
				</div>
				<span class="paddingLeft">结束日期： </span>
                <div class="timeBox">
					<el-date-picker v-model="endTime" type="date" format="yyyy-MM-dd" value-format="timestamp" placeholder="结束日期"></el-date-picker>
				</div>
				<span class="paddingLeft">流媒体IP： </span><input class="zInput" type="text" placeholder=""  v-model='stream_server_ip'/>
				<span class="paddingLeft">流媒体端口： </span><input class="zInput" type="text" placeholder="" v-model='stream_server_port' />
				<div class="onlyLine">
                    <span class="paddingLeft">操作类型：</span>
                    <div class="zSelect">
                        <el-select v-model="operateValue" class="zgroup" placeholder="--请选择--">
                            <el-option v-for="item in operateData" 
                            :key="item.index"  :label="item.description" :value="item.value"></el-option>
                        </el-select>
                    </div>
                    <button class="buttonradius" @click="findData">查询</button>
				    <button class="buttonradius" @click="clearData">清空</button>
                </div>
			</div>
			<!-- table  -->
			<div class="zTable">
				<div class="elTable">
					<div class="scrollbox">
						<el-table
						:data="userlogData"
						>
							<el-table-column prop="realname" label="用户姓名">
								<template slot-scope="scope">
									<span v-if='scope.row.realname'>{{scope.row.realname}}</span>
									<span v-else>暂无数据</span>
								</template>
							</el-table-column>
							<el-table-column prop="app_account" label="登录账号">
								<template slot-scope="scope">
									<span v-if='scope.row.app_account'>{{scope.row.app_account}}</span>
									<span v-else>暂无数据</span>
								</template>
							</el-table-column>
							<el-table-column prop="stream_account" label="视联网账号">
								<template slot-scope="scope">
									<span v-if='scope.row.stream_account'>{{scope.row.stream_account}}</span>
									<span v-else>暂无数据</span>
								</template>
							</el-table-column>
							<el-table-column prop="start_time" label="开始时间">
								<template slot-scope="scope">
									<span  v-if='scope.row.start_time'>{{ scope.row.start_time | FormatDate('yyyy-MM-dd hh:mm:ss') }}</span>
									<span v-else>暂无数据</span>
								</template>
							</el-table-column>
							<el-table-column prop="end_time" label="结束时间">
								<template slot-scope="scope">
									<span  v-if='scope.row.end_time'>{{ scope.row.end_time | FormatDate('yyyy-MM-dd hh:mm:ss') }}</span>
									<span v-else>暂无数据</span>
								</template>
							</el-table-column>
							<el-table-column prop="duration" label="时长">
								<template slot-scope="scope">
									<span v-if='scope.row.duration'>{{scope.row.duration}}</span>
									<span v-else>暂无数据</span>
								</template>
							</el-table-column>
							<el-table-column prop="operation_type" label="操作类型"></el-table-column>
							<el-table-column prop="app_version_name" label="APP版本">
								<template slot-scope="scope">
									<span v-if='scope.row.app_version_name'>{{scope.row.app_version_name}}</span>
									<span v-else>暂无数据</span>
								</template>
							</el-table-column>
							<el-table-column prop="" label="操作" >
								<template slot-scope="scope">
									<span class="spanBtn" @click="detailClick(scope.row)">查看详情</span>
								</template>
							</el-table-column>
						</el-table>
					</div>
					<!-- page -->
					<el-pagination
						@current-change="handleCurrentChange" 
						:current-page.sync="page_total_pages" 
						:page-size="page_size" 
						layout="total, prev, pager, next, jumper" 
						:total="page_total_items"
						class="zPage"
						>
					</el-pagination>
				</div>
			</div>
		</div>
		 <!-- 详情弹窗 -->
		<el-dialog  title="详情" 
			:visible.sync="detailPop"
			id="zDialogtext"
		 	width="60%">
			<div class="block block-inline" id="detailW2">
				<li v-for='item in logDetaildata' :key="item.index">
					<span class="liL">{{item.label}}</span>
					<span class="liR" v-if='item.content'>{{item.content}}</span>
					<span class="liR" v-else>暂无数据</span>
				</li>
			</div>
			<div class="userBtn">
				<el-button size="small" @click="detailPop = false">关闭</el-button>
			</div>
		</el-dialog>
	</div>
</template>
<script>
  	/* 展示弹窗样式文件 */
    import '../../style/common.css' /*引入公共样式*/
	// js
	import {heightAuto} from '../../untils/heightAuto' //注意路径
	/*  api 文件引入 */
	import {getAllmoduleEntries,getApplogDetail, getApplist,listOperationtypes} from '@/page/api/log'
	export default {
        data() {
			return {
				userlogData : [],
				operateData : [],
				operateValue : '',
                startTime: '',
				endTime: '',
				stream_server_ip : '',
				stream_server_port : '',
				// 详情弹窗
				detailPop : false,
				logDetaildata : [],
				/* 分页相关 */
				page_size : 10,			//  请求多少条目
				page_total_items : 0,  // 总条数
				page_total_pages : 1,  //  当前条数
			}
		},
		methods:{
			// 初始化前端下拉框
			getInitoperation(){
				// listOperationtypes
				listOperationtypes({}).then(res => {
					if (res.status === 200 && res.data.result == "ok") {
						this.operateData = res.data.data;
					}
				});	
			},	
			// 初始化数据接口
			getInitializationdata(){
				//  getApplogDetail
				//  初始化数据接口
				let objData = {
					"begin_time": this.startTime,
					// "end_time": this.endTime,
					"enterprise_id": localStorage.EnterpriseId,
					"enterprise_user_id": localStorage.userId,
					// "operation_type": this.operateValue,
					// "stream_server_ip": this.stream_server_ip,
					// "stream_server_port": this.stream_server_port,
					"page_number": this.page_total_pages - 1,
					"page_size": this.page_size,
				}
				// console.log(objData)
				if(this.endTime!=""){
					objData.endTime= this.endTime

				}
					if(this.operateValue!=""){
					objData.operation_type= this.operateValue

				}

	              if(this.stream_server_ip!=""){
					objData.stream_server_ip= this.stream_server_ip

				}
					if(this.stream_server_port!=""){
					objData.stream_server_port= this.stream_server_port

				}



				console.log(objData)
				// 数据判断
				// 判断 开始日期是否为空
				if(objData.begin_time == ''){
					// 获取今天0点时间 为默认值
					// let start = new Date(new Date(new Date().toLocaleDateString()).getTime() - 24*60*60*1000);
					let start = new Date(new Date(new Date().toLocaleDateString()).getTime() - 24*60*60*1000);

					objData.begin_time = start.getTime()
					var ingtime=this.timestampToTime(objData.begin_time)
						  console.log(ingtime)
				}
				// ajax
				getApplist(objData).then(res => {
					if (res.status === 200 && res.data.result == "ok") {
						  console.log(res)
						this.userlogData = res.data.data.list;
					}
				});	
			},
			findData(){
				this.getInitializationdata();
			},
			clearData(){
				this.startTime = '';
				this.endTime = '';
				this.operateValue = '';
				this.stream_server_ip = '';
				this.stream_server_port = '';
				this.getInitializationdata();
			},
			// 详情
			detailClick(scope){
				let objData = {
					"id": scope.id,
				}
				// getApplogDetail
				getApplogDetail(objData).then(res => {
					if (res.status === 200 && res.data.result == "ok") {
						this.logDetaildata = res.data.data;
						this.detailPop = true;
					}
				});	
			},
			// page
			handleCurrentChange(currentPage) {
				this.page_total_pages = currentPage;
				this.getInitializationdata();
			},
		},
		mounted: function() {
			let row = '.userlogList'
			heightAuto(row)
			this.getInitializationdata();
			this.getInitoperation();
		},
	}
	
</script>
<style scoped>
.popInput{
	width: 100%;
    height: 36px;
    font-size: 14px;
    margin-left: 10px;
    line-height: 36px;
    padding-left: 4px !important;
    margin-right: 20px;
    background: #2a3558;
    border: 1px #3b4872 solid;
	text-indent: 1em;
}
.spanBtn{
	cursor: pointer;
	margin: 0 5px;
}
.onlyLine{
	width: 100%;
    display: inline-block;
    margin-top: 20px;
}
.zPage{
	margin-top: 50px;
}
.timeBox {
	float: left;
	width: 198px;
	margin: 0 20px 0 3px;
}
/* 弹窗详情 左右 */
#zDialogtex #detailW2{
	overflow: hidden;
}
#detailW2 li{
	width: 47%!important;
	margin: 0;
}
#detailW2 li:nth-child(2n){
	margin-left: 6%;
}
</style>

<style lang="scss">
	#userlog {
		.userlogList {
			padding: 34px 42px;
			margin: 15px 27px 15px 15px;
			background: #354166;
			box-shadow: 0 0 26px #01060e;
			.zForm {
				span {
					float: left;
					color: #eee;
					display: block;
					font-size: 14px;
					overflow: hidden;
					line-height: 36px;
				}
				button {
					float: left;
					color: #eee;
					height: 38px;
					font-size: 14px;
					margin-left: 11px;
					text-align: center;
					line-height: 38px;
					padding: 0px 15px;
					background: #1b274c;
					border: 1px #3b4872 solid;
				}
				button:hover {
					background: #57e29b;
				}
				.zSelect {
                    float: left;
                    width: 206px;
                    margin-left: 10px;
				}
				.paddingLeft {
					padding-left: 20px;
				}
				.zInput {
					float: left;
					width: 200px;
					height: 36px;
					font-size: 14px;
					margin-left:10px;
					line-height: 36px;
					padding-left: 4px !important;
					margin-right: 20px;
					background: #2a3558;
					border: 1px #3b4872 solid;
				}
			}
			.zTable {
				clear: both;
				height: 94%;
				overflow: hidden;
				padding-top: 26px;
				.elTable {
					height: 91.7%;
					overflow: hidden;
					.el-table .warning-row td {
						color: oldlace;
						background-color: transparent;
					}
					.el-table .warning-row {
						background: -webkit-linear-gradient(#3f7984, #485b7d, #3f7984);
						background: -o-linear-gradient(#3f7984, #485b7d, #3f7984);
						background: -moz-linear-gradient(#3f7984, #485b7d, #3f7984);
						background: linear-gradient(#3f7984, #485b7d, #3f7984);
						filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#3f7984', endColorstr='#485b7d', GradientType=0);
						border-top: 2px #57e29b solid;
						border-bottom: 2px #57e29b solid;
					}
					.el-table .success-row {
						background-color: #6ee2c1;
						color: #f0f9eb;
					}
					.el-table .warning-row td {
						color: oldlace;
					}
					.el-table .success-row td {
						color: #f0f9eb;
					}
					.el-table .warning-row td div {
						color: oldlace;
					}
					.el-table .success-row td div {
						color: #f0f9eb;
					}
				}
			}
		}
		input.el-input__inner:hover {
			border: 1px #3b4872 solid;
		}
		.el-input__icon {
			width: 37px;
		}
		.el-input--prefix .el-input__inner {
			padding-left: 38px;
		}
	}
	@media screen and (max-width: 1440px) {
		#userlog {
			.mRightTwo {
				.paddingLeft {
					padding-left: 10px;
				}
				.zForm {
					button {
						height: 30px;
						font-size: 12px !important;
						line-height: 30px;
						padding-left: 8px;
						padding-right: 8px;
					}
					span {
						font-size: 12px !important;
					}
					span.btnRight {
						float: left;
						/*margin-top: 10px;*/
					}
					.zInput {
						width: 100px !important;
						height: 28px;
						line-height: 28px;
					}
					.zgroup {
						height: 30px;
					}
					.zSelect {
						float: left;
						width: 106px;
					}
				}
				.zTable {
					clear: both;
					height: 94%;
					overflow: hidden;
					padding-top: 26px;
					.elTable {
						height: 82%;
						.el-table td {
							padding: 4px 0;
						}
					}
				}
			}
		}
	}
	@media screen and (max-width: 1366px) {
		#userlog .mRightTwo .el-dialog .el-dialog__body{
			padding: 24px 24px 10px;
		}
		#userlog {
			.mRightTwo {
				.paddingLeft {
					padding-left: 10px;
				}
				.zForm {
					button {
						height: 30px;
						font-size: 12px !important;
						line-height: 30px;
						padding-left: 5px;
						padding-right: 5px;
					}
					span {
						font-size: 12px !important;
					}
					span.btnRight {
						float: left;
					}
					.zInput {
						width: 80px !important;
						height: 28px;
						line-height: 28px;
					}
					.zgroup {
						height: 30px;
					}
					.zSelect {
						float: left;
						width: 104px;
					}
				}
				.el-select-dropdown__item {
					font-size: 12px;
				}
			}
		}
    }
</style>